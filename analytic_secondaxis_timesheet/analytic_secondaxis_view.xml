<openerp>
    <data>

        #---------------------------------------------------------------------------------------------------------
        #   timesheet form in the timesheet_sheet
        #---------------------------------------------------------------------------------------------------------
        <record model="ir.ui.view" id="hr_timesheet_sheet_form_with_activity">
            <field name="name">hr.timesheet.sheet.form</field>
            <field name="model">hr_timesheet_sheet.sheet</field>
            <field name="inherit_id" ref="hr_timesheet_sheet.hr_timesheet_sheet_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='timesheet_ids']/tree//field[@name='name']" position="before">
                     <field name="activity" context="{'account_id':account_id}" options="{'no_create': True}" required="True"/>
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']/form//field[@name='name']" position="before">
                     <field name="activity" context="{'account_id':account_id}" options="{'no_create': True}" required="True"/>
                </xpath>
            </field>
        </record>

        #---------------------------------------------------------------------------------------------------------
        #   Add activity on hr.analytic.timesheet
        #---------------------------------------------------------------------------------------------------------
        <record id="hr_timesheet_line_form" model="ir.ui.view">
            <field name="name">account.analytic.line.form</field>
            <field name="model">account.analytic.line</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_form"/>
            <field name="arch" type="xml">
                <xpath expr="/form/sheet/notebook/page/group/group[@name='accounting']/field[@name='account_id']" position="after">
                    <field name="activity" context="{'account_id':account_id}" options="{'no_create': True}" required="True"/>
                </xpath>
            </field>
        </record>

        <record id="hr_timesheet_line_tree" model="ir.ui.view">
            <field name="name">account.analytic.line.tree</field>
            <field name="model">account.analytic.line</field>
            <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_tree"/>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <xpath expr="/tree/field[@name='account_id']" position="after">
                    <field name="activity" context="{'account_id':account_id}" options="{'no_create': True}" required="True"/>
                </xpath>
            </field>
        </record>

        #---------------------------------------------------------------------------------------------------------
        #   Add activity on search hr.analytic.timesheet
        #---------------------------------------------------------------------------------------------------------
        <record id="hr_timesheet_line_search" model="ir.ui.view">
            <field name="name">account.analytic.line.search</field>
            <field name="model">account.analytic.line</field>
            <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_search"/>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <!-- The filter for activities should be inserted after
                     'Analytic Account' but there is no way to properly
                     select this element, because no name tag was added
                     by Odoo for now. So for the moment we just place it
                     as a last filter.
                -->
                <xpath expr="/search/group/filter[last()]" position="after">
                    <filter string="Activity" context="{'group_by':'activity'}"/>
                </xpath>
            </field>
        </record>

    </data>
</openerp>
